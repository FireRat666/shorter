<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="color-scheme" content="dark">
    <link rel="stylesheet" type="text/css" href="/shorter.css" integrity="{{.CssSRIHash}}">
    <title>User Management - {{.Domain}}</title>
</head>
<body>
    <div class="content">
        <div class="header">
            <img src="/logo.png">
            <h1>User Management: {{.Domain}}</h1>
        </div>

        <div class="header-links">
            <a href="/admin/" class="button">Dashboard</a>
            <a href="/admin/users?domain={{.Domain}}" class="button button-yellow">Users</a>
            <a href="/admin/api-keys" class="button">API Keys</a>
			<a href="/admin/stats" class="button">Statistics</a>
			<a href="/admin/abuse-reports" class="button">Abuse Reports</a>
			<a href="/admin/security" class="button">Account Settings</a>
            <a href="/logout" class="button button-red">Logout</a>
        </div>

        <div class="tos">
            <a href="/admin/edit?domain={{.Domain}}" class="button">Back to Domain Settings</a>

            <h2 class="section-subtitle">Create New User</h2>
            <form class="admin-form" method="POST" action="/admin/users/create">
                <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                <input type="hidden" name="domain" value="{{.Domain}}">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" class="inputbox" required>
                <label for="password">Password:</label>
                <input type="password" id="password" name="password" class="inputbox" required>
                <label for="role">Role:</label>
                <select id="role" name="role" class="inputbox" required>
                    <option value="user">User</option>
                    <option value="moderator">Moderator</option>
                </select>
                <input type="submit" value="Create User" class="admin-submit-button">
            </form>
            {{if .Error}}
                <p class="info">{{.Error}}</p>
            {{end}}
        </div>

        <div class="tos">
            <h2 class="section-subtitle">Existing Users</h2>
            <form class="search-form" method="GET" action="/admin/users">
                <input type="hidden" name="domain" value="{{.Domain}}">
                <input type="text" name="q" class="inputbox" placeholder="Search by username..." value="{{.SearchQuery}}">
                <input type="submit" value="Search" class="button">
                <a href="/admin/users?domain={{.Domain}}" class="button clear-button">Clear</a>
            </form>

            {{if .Users}}
                <table>
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>UserID</th>
                            <th>Role</th>
                            <th>Created At</th>
                            <th>Edit</th>
                            <th>Delete</th>
                        </tr>
                    </thead>
                    <tbody>
                    {{range .Users}}
                        <tr>
                            <td>{{.Username}}</td>
                            <td>{{.ID}}</td>
                            <td>{{.Role}}</td>
                            <td>{{.CreatedAt.Format "2006-01-02"}}</td>
                            <td>
                                <a href="/admin/edit-user?domain={{$.Domain}}&user_id={{.ID}}" class="button">Edit</a>
                            </td>
                            <td>
                                <form method="POST" action="/admin/users/delete" style="display: inline;">
                                    <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
                                    <input type="hidden" name="domain" value="{{$.Domain}}">
                                    <input type="hidden" name="user_id" value="{{.ID}}">
                                    <input type="submit" value="Delete" class="button-red" data-confirm="Are you sure you want to delete this user? This will also delete all links created by this user.">
                                </form>
                            </td>
                        </tr>
                    {{end}}
                    </tbody>
                </table>

                <div class="pagination-controls">
                    {{if .HasPrev}}
                        <a href="/admin/users?domain={{.Domain}}&q={{.SearchQuery}}&page={{sub .CurrentPage 1}}" class="pagination-button">&laquo; Previous</a>
                    {{end}}
                    {{if gt .TotalPages 1}}\
                        <span>Page {{.CurrentPage}} of {{.TotalPages}}</span>
                    {{end}}
                    {{if .HasNext}}
                        <a href="/admin/users?domain={{.Domain}}&q={{.SearchQuery}}&page={{add .CurrentPage 1}}" class="pagination-button">Next &raquo;</a>
                    {{end}}
                </div>
            {{else}}
                <p>No users found for this domain.</p>
            {{end}}
        </div>
    </div>
</body>
</html>