<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="color-scheme" content="dark">
    <link rel="stylesheet" type="text/css" href="/shorter.css" integrity="{{.CssSRIHash}}">
    <title>Site Statistics</title>
</head>
<body>
    <div class="content">
        <div class="header">
            <h1>Site Statistics</h1>
            <a href="/admin" class="admin-back-link">Back to Admin Panel</a>
        </div>

        <div class="tos">
            <h2>Overall Statistics</h2>
            <div id="overall-stats-container">
                <button id="load-overall-stats" class="button">Load Overall Statistics</button>
            </div>
        </div>

        <div class="tos">
            <h2>Recent Activity</h2>
            <div id="recent-activity-container">
                <button id="load-recent-activity" class="button">Load Recent Activity</button>
            </div>
        </div>

        <div class="tos">
            <h2>Top 10 Most Clicked Links</h2>
            <div id="top-links-container">
                <button id="load-top-links" class="button">Load Top Links</button>
            </div>
        </div>

        <div class="tos">
            <h2>Links by Creator</h2>
            <div id="creator-stats-container">
                <button id="load-creator-stats" class="button">Load Creator Stats</button>
            </div>
        </div>

        <div class="tos">
            <input id="reset-stats-toggle" class="toggle-checkbox" type="checkbox" />
            <label for="reset-stats-toggle" class="toggle-label">Reset Statistics</label>
            <div class="toggle-content">
                <p class="info"><strong>Warning:</strong> This will permanently delete all historical click and expiration data, and reset click counts on all active links to zero. This action cannot be undone.</p>
                <form method="POST" action="/admin/stats/reset">
                    <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                    <input type="submit" value="Reset All Statistics" class="delete-button" data-confirm="Are you sure you want to reset all statistics? This is irreversible.">
                </form>
            </div>
        </div>
    </div>

    <script nonce="{{.Nonce}}">
        function loadStatSection(buttonId, containerId, endpoint) {
            const button = document.getElementById(buttonId);
            const container = document.getElementById(containerId);

            button.addEventListener('click', () => {
                button.disabled = true;
                button.textContent = 'Loading...';

                fetch(endpoint)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.text();
                    })
                    .then(html => {
                        container.innerHTML = html;
                    })
                    .catch(error => {
                        console.error('Error loading stats:', error);
                        container.innerHTML = `<p class="error">Failed to load data. Please check the console for details.</p>`;
                    });
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadStatSection(
                'load-overall-stats',
                'overall-stats-container',
                '/admin/stats/overall'
            );
            loadStatSection(
                'load-recent-activity',
                'recent-activity-container',
                '/admin/stats/recent-activity'
            );
            loadStatSection(
                'load-top-links',
                'top-links-container',
                '/admin/stats/top-links'
            );
            loadStatSection(
                'load-creator-stats',
                'creator-stats-container',
                '/admin/stats/creator-stats'
            );
        });
    </script>
</body>
</html>